(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{519:function(s,n,a){s.exports=a.p+"assets/img/upload-file.b2b67b8c.gif"},765:function(s,n,a){s.exports=a.p+"assets/img/guide-map.ea70209e.jpg"},766:function(s,n,a){s.exports=a.p+"assets/img/finish-demo.928de17c.gif"},767:function(s,n,a){s.exports=a.p+"assets/img/jiahao-ruisen-min-code.042f1be7.jpg"},768:function(s,n,a){s.exports=a.p+"assets/img/static-ui.0ed13b00.jpg"},769:function(s,n,a){s.exports=a.p+"assets/img/ui-static.d51c94df.gif"},770:function(s,n,a){s.exports=a.p+"assets/img/imgSecCheck.28a13703.jpg"},771:function(s,n,a){s.exports=a.p+"assets/img/limt-img-size-.678705a0.png"},772:function(s,n,a){s.exports=a.p+"assets/img/over1M-fail.21bc0b60.gif"},773:function(s,n,a){s.exports=a.p+"assets/img/over1M-fail-tip.d3c27613.png"},774:function(s,n,a){s.exports=a.p+"assets/img/cloud-collection.4f871cd8.png"},965:function(s,n,a){"use strict";a.r(n);var e=a(12),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,e=s._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"小程序-云开发-多图片内容安全检测"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#小程序-云开发-多图片内容安全检测"}},[s._v("#")]),s._v(" 小程序-云开发-多图片内容安全检测")]),s._v(" "),e("h2",{attrs:{id:"全文导图"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#全文导图"}},[s._v("#")]),s._v(" 全文导图")]),s._v(" "),e("img",{staticClass:"medium-zoom",attrs:{src:a(765),alt:"小程序-云开发-多图片内容安全检测"}}),s._v(" "),e("h2",{attrs:{id:"快速导航"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#快速导航"}},[s._v("#")]),s._v(" 快速导航")]),s._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"#%E5%B0%8F%E7%A8%8B%E5%BA%8F-%E4%BA%91%E5%BC%80%E5%8F%91-%E5%A4%9A%E5%9B%BE%E7%89%87%E5%86%85%E5%AE%B9%E5%AE%89%E5%85%A8%E6%A3%80%E6%B5%8B"}},[s._v("小程序-云开发-多图片内容安全检测")])]),s._v(" "),e("li",[e("a",{attrs:{href:"#%E5%85%A8%E6%96%87%E5%AF%BC%E5%9B%BE"}},[s._v("全文导图")])]),s._v(" "),e("li",[e("a",{attrs:{href:"#%E5%BF%AB%E9%80%9F%E5%AF%BC%E8%88%AA"}},[s._v("快速导航")])]),s._v(" "),e("li",[e("a",{attrs:{href:"#%E5%89%8D%E8%A8%80"}},[s._v("前言")])]),s._v(" "),e("li",[e("a",{attrs:{href:"#%E5%85%88%E7%9C%8B%E4%B8%80%E4%B8%8B%E7%A4%BA%E4%BE%8B%E6%95%88%E6%9E%9C"}},[s._v("先看一下示例效果")])]),s._v(" "),e("li",[e("a",{attrs:{href:"#%E5%AE%8C%E6%88%90-ui-%E5%B1%95%E7%A4%BA"}},[s._v("完成 UI 展示")])]),s._v(" "),e("li",[e("a",{attrs:{href:"#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"}},[s._v("应用场景")])]),s._v(" "),e("li",[e("a",{attrs:{href:"#%E8%A7%A3%E5%86%B3%E5%9B%BE%E7%89%87%E5%AE%89%E5%85%A8%E7%9A%84%E6%96%B9%E5%BC%8F"}},[s._v("解决图片安全的方式")])]),s._v(" "),e("li",[e("a",{attrs:{href:"#%E4%BA%91%E8%B0%83%E7%94%A8%E6%96%B9%E5%BC%8F"}},[s._v("云调用方式")])]),s._v(" "),e("li",[e("a",{attrs:{href:"#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"}},[s._v("常见问题")]),s._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"#%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E5%A4%9A%E5%9B%BE%E4%B8%8A%E4%BC%A0%E8%A6%86%E7%9B%96%E7%9A%84%E9%97%AE%E9%A2%98"}},[s._v("如何解决多图上传覆盖的问题")])])])]),s._v(" "),e("li",[e("a",{attrs:{href:"#%E7%BB%93%E8%AF%AD"}},[s._v("结语")])])]),s._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"#%E7%BB%93%E8%AF%AD"}},[s._v("结语")])])]),s._v(" "),e("h2",{attrs:{id:"前言"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),e("p",[s._v("相比于文本的安全检测,图片的安全检测要稍微略复杂一些,当您读完本篇,将 get 到")]),s._v(" "),e("ul",[e("li",[s._v("图片安全检测的应用场景")]),s._v(" "),e("li",[s._v("解决图片的安全方式")]),s._v(" "),e("li",[s._v("使用云开发中云调用方式对图片进行检测")]),s._v(" "),e("li",[s._v("如何对上传图片大小进行限制")]),s._v(" "),e("li",[s._v("如何解决多图上传覆盖问题")])]),s._v(" "),e("p",[s._v("如有收获,不忘三连击(给赞,留言,分享~")]),s._v(" "),e("h2",{attrs:{id:"先看一下示例效果"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#先看一下示例效果"}},[s._v("#")]),s._v(" 先看一下示例效果")]),s._v(" "),e("p",[s._v("当用户上传敏感违规图片时,禁止用户上传发布,并且做出相对应的用户友好提示\n"),e("img",{staticClass:"medium-zoom",attrs:{src:a(766),alt:"最终完成实例效果"}})]),s._v(" "),e("p",[s._v("如果您想体验,可微信扫下方小程序码,进入发布页面体验")]),s._v(" "),e("img",{staticClass:"medium-zoom",attrs:{src:a(767),alt:"佳豪瑞森装饰微信小程序码"}}),s._v(" "),e("h2",{attrs:{id:"完成-ui-展示"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#完成-ui-展示"}},[s._v("#")]),s._v(" 完成 UI 展示")]),s._v(" "),e("p",[s._v("对于"),e("code",[s._v("wxml")]),s._v("与"),e("code",[s._v("wxss")]),s._v(",大家可以自行任意修改,本文重点在于图片安全的校验")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('<view class="image-list">\n   \x3c!-- 显示图片 --\x3e\n   <block wx:for="{{images}}" wx:key="*this"><view class="image-wrap">\n       <image class="image" src="{{item}}" mode="aspectFill" bind:tap="onPreviewImage" data-imgsrc="{{item}}"></image><i class="iconfont icon-shanchu" bind:tap="onDelImage" data-index="{{index}}"></i></view>\n   </block>\n   \x3c!-- 选择图片 --\x3e\n   <view class="image-wrap selectphoto" hidden="{{!selectPhoto}}" bind:tap="onChooseImage">\n        <i class="iconfont icon-add"></i>\n   </view>\n</view>\n<view class="footer">\n    <button class="send-btn"  bind:tap="send">发布</button>\n </view>\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br")])]),e("p",[s._v("对应的"),e("code",[s._v("wxss")]),s._v(" 代码")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v(".footer {\n  display: flex;\n  align-items: center;\n  width: 100%;\n  box-sizing: border-box;\n  background: #34bfa3;\n}\n\n.send-btn {\n  width: 100%;\n  color: #fff;\n  font-size: 32rpx;\n  background: #34bfa3;\n}\n\nbutton {\n  border-radius: 0rpx;\n}\n\nbutton::after {\n  border-radius: 0rpx !important;\n}\n\n/* 图片样式 */\n.image-list {\n  display: flex;\n  flex-wrap: wrap;\n  margin-top: 20rpx;\n}\n\n.image-wrap {\n  width: 220rpx;\n  height: 220rpx;\n  margin-right: 10rpx;\n  margin-bottom: 10rpx;\n  position: relative;\n  overflow: hidden;\n  text-align: center;\n}\n\n.image {\n  width: 100%;\n  height: 100%;\n}\n\n.icon-shanchu {\n  position: absolute;\n  top: 0;\n  right: 0;\n  width: 40rpx;\n  height: 40rpx;\n  background-color: #000;\n  opacity: 0.4;\n  color: #fff;\n  text-align: center;\n  line-height: 40rpx;\n  font-size: 38rpx;\n  font-weight: bolder;\n}\n\n.selectphoto {\n  border: 2rpx dashed #cbd1d7;\n  position: relative;\n}\n\n.icon-add {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  color: #cbd1d7;\n  font-size: 60rpx;\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br"),e("span",{staticClass:"line-number"},[s._v("61")]),e("br"),e("span",{staticClass:"line-number"},[s._v("62")]),e("br"),e("span",{staticClass:"line-number"},[s._v("63")]),e("br"),e("span",{staticClass:"line-number"},[s._v("64")]),e("br"),e("span",{staticClass:"line-number"},[s._v("65")]),e("br"),e("span",{staticClass:"line-number"},[s._v("66")]),e("br"),e("span",{staticClass:"line-number"},[s._v("67")]),e("br"),e("span",{staticClass:"line-number"},[s._v("68")]),e("br"),e("span",{staticClass:"line-number"},[s._v("69")]),e("br"),e("span",{staticClass:"line-number"},[s._v("70")]),e("br"),e("span",{staticClass:"line-number"},[s._v("71")]),e("br"),e("span",{staticClass:"line-number"},[s._v("72")]),e("br"),e("span",{staticClass:"line-number"},[s._v("73")]),e("br")])]),e("p",[s._v("最终呈现的 UI,如下所示")]),s._v(" "),e("img",{staticClass:"medium-zoom lazy",attrs:{loading:"lazy",alt:"静态UI展示",src:a(768)}}),s._v(" "),e("p",[s._v("对应的"),e("code",[s._v("JS")]),s._v("代码")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("/*\n* 涉及到的API:wx.chooseImage 从本地相册选择图片或使用相机拍照\n*(https://developers.weixin.qq.com/miniprogram/dev/api/media/image/wx.chooseImage.html)\n*\n*\n*/\n// 最大上传图片数量\nconst MAX_IMG_NUM = 9;\n\nconst db = wx.cloud.database(); // 初始化云数据库\nPage({\n\n  /**\n   * 页面的初始数据\n   */\n  data: {\n    images: [], // 把上传的图片存放在一个数组对象里面\n    selectPhoto: true, // 添加+icon元素是否显示\n  },\n\n  /**\n   * 生命周期函数--监听页面加载\n   */\n  onLoad: function (options) {\n\n  },\n\n  // 选择图片\n  onChooseImage() {\n    // 还能再选几张图片,初始值设置最大的数量-当前的图片的长度\n    let max = MAX_IMG_NUM - this.data.images.length;\n    wx.chooseImage({\n      count: max, // count表示最多可以选择的图片张数\n      sizeType: ['original', 'compressed'], // 所选的图片的尺寸\n      sourceType: ['album', 'camera'], // 选择图片的来源\n      success: (res) => { // 接口调用成功的回调函数console.log(res)\n        this.setData({ // tempFilePath可以作为img标签的src属性显示图片,下面是将后添加的图片与之前的图片给追加起来\n          images: this.data.images.concat(res.tempFilePaths)\n        })\n        // 还能再选几张图片\n        max = MAX_IMG_NUM - this.data.images.length\n        this.setData({\n          selectPhoto: max <= 0 ? false : true  // 当超过9张时,加号隐藏\n        })\n      },\n    })\n  },\n\n  // 点击右上方删除图标,删除图片操作\n  onDelImage(event) {\n    const index = event.target.dataset.index;\n    // 点击删除当前图片,用splice方法,删除一张,从数组中移除一个\n    this.data.images.splice(index, 1)\n    this.setData({\n      images: this.data.images\n    })\n    // 当添加的图片达到设置最大的数量时,添加按钮隐藏,不让新添加图片\n    if (this.data.images.length == MAX_IMG_NUM - 1) {\n      this.setData({\n        selectPhoto: true,\n      })\n    }\n  },\n})\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br"),e("span",{staticClass:"line-number"},[s._v("61")]),e("br"),e("span",{staticClass:"line-number"},[s._v("62")]),e("br"),e("span",{staticClass:"line-number"},[s._v("63")]),e("br"),e("span",{staticClass:"line-number"},[s._v("64")]),e("br")])]),e("p",[s._v("最终实现的前端 UI 效果如下所是:\n"),e("img",{staticClass:"medium-zoom lazy",attrs:{loading:"lazy",alt:"动态UI展示",src:a(769)}})]),s._v(" "),e("p",[s._v("您现在看到的效果,没有任何云函数代码,只是前端的纯静态展示,对于一些涉嫌敏感图片,是有必要进行做过滤处理的")]),s._v(" "),e("h2",{attrs:{id:"应用场景"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#应用场景"}},[s._v("#")]),s._v(" 应用场景")]),s._v(" "),e("p",[s._v("通常,在校验一张图片是否含有违法违规内容相比于文本安全的校验,同样重要,有如下应用")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("图片智能鉴黄：涉及拍照的工具类应用(如美拍，识图类应用)用户拍照上传检测；电商类商品上架图片检测；媒体类用户文章里的图片检测等")])]),s._v(" "),e("li",[e("p",[s._v("敏感人脸识别：用户头像；媒体类用户文章里的图片检测；社交类用户上传的图片检测等,凡是有用户自发生产内容的都应当提前做检测")])])]),s._v(" "),e("h2",{attrs:{id:"解决图片安全的方式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#解决图片安全的方式"}},[s._v("#")]),s._v(" 解决图片安全的方式")]),s._v(" "),e("p",[s._v("在小程序开发中,提供了"),e("strong",[s._v("两种方式")])]),s._v(" "),e("ul",[e("li",[s._v("HTTPS 调用")]),s._v(" "),e("li",[s._v("云调用")])]),s._v(" "),e("p",[s._v("HTTPS 调用的请求接口地止")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("https://api.weixin.qq.com/wxa/img_sec_check?access_token=ACCESS_TOKEN\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("检测图片审核,根据官方文档得知,需要两个必传的参数:分别是:"),e("code",[s._v("access_token(接口调用凭证)")]),s._v(","),e("code",[s._v("media(要检测的图片文件)")])]),s._v(" "),e("p",[s._v("对于"),e("code",[s._v("HTTPS")]),s._v("调用方式,愿意折腾的小伙伴可以参考"),e("a",{attrs:{href:"https://mp.weixin.qq.com/s/nCBAjFIkq92x2LAioskSgw",target:"_blank",rel:"noopener noreferrer"}},[s._v("文本内容安全检测(上篇)"),e("OutboundLink")],1),s._v("的处理方式,处理大同小异,本篇主要以云开发的云调用为主")]),s._v(" "),e("h2",{attrs:{id:"云调用方式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#云调用方式"}},[s._v("#")]),s._v(" 云调用方式")]),s._v(" "),e("p",[s._v("在"),e("code",[s._v("cloudfunctions")]),s._v("目录文件夹下创建云函数"),e("code",[s._v("imgSecCheck")]),s._v("(名字任意,但最好见名知意)\n"),e("img",{staticClass:"medium-zoom lazy",attrs:{loading:"lazy",alt:"云函数端创建云函数",src:a(770)}})]),s._v(" "),e("p",[s._v("并在该目录下创建"),e("code",[s._v("config.json")]),s._v(",配置参数如下所示")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('{\n  "permissions": {\n    "openapi": [\n      "security.imgSecCheck"\n    ]\n  }\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[s._v("配置完后,在主入口"),e("code",[s._v("index.js")]),s._v("中,如下所示,通过"),e("code",[s._v("security.imgSecCheck")]),s._v("接口,并传入"),e("code",[s._v("media")]),s._v("对象")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("// 云函数入口文件\nconst cloud = require('wx-server-sdk');\ncloud.init({\n  env: cloud.DYNAMIC_CURRENT_ENV\n})\n\n// 云函数入口函数\nexports.main = async (event, context) => {\n  const wxContext = cloud.getWXContext()\n  try {\n    const result = await cloud.openapi.security.imgSecCheck({\n      media: {\n        contentType: 'image/png',\n        value: Buffer.from(event.img) // 这里必须要将小程序端传过来的进行Buffer转化,否则就会报错,接口异常\n      }\n\n    })\n\n    if (result && result.errCode.toString() === '87014') {\n      return { code: 500, msg: '内容含有违法违规内容', data: result }\n    } else {\n      return { code: 200, msg: '内容ok', data: result }\n    }\n  } catch (err) {\n    // 错误处理\n   if (err.errCode.toString() === '87014') {\n      return { code: 500, msg: '内容含有违法违规内容', data: err }\n    }\n    return { code: 502, msg: '调用imgSecCheck接口异常', data: err }\n  }\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br")])]),e("p",[s._v("您会发现在云函数端,就这么几行代码,就完成了图片安全校验\n而在小程序端,代码如下所示")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("// miniprogram/pages/imgSecCheck/imgSecCheck.js\n// 最大上传图片数量\nconst MAX_IMG_NUM = 9;\n\nconst db = wx.cloud.database() // 云数据库初始化\nPage({\n\n  /**\n   * 页面的初始数据\n   */\n  data: {\n    images: [],\n    selectPhoto: true, // 添加图片元素是否显示\n  },\n\n  /**\n   * 生命周期函数--监听页面加载\n   */\n  onLoad: function (options) {\n\n  },\n  // 选择图片\n  onChooseImage() {\n    // const that = this; // 如果下面用了箭头函数,那么这行代码是不需要的,直接用this就可以了的\n// 还能再选几张图片,初始值设置最大的数量-当前的图片的长度\n    let max = MAX_IMG_NUM - this.data.images.length;\n    wx.chooseImage({\n      count: max,\n      sizeType: ['original', 'compressed'],\n      sourceType: ['album', 'camera'],\n      success: (res) => { // 这里若不是箭头函数,那么下面的this.setData的this要换成that上面的临时变量,作用域的问题,不清楚的,可以看下this指向相关的知识\n        console.log(res)\n       // tempFilePath可以作为img标签的src属性显示图片\n        const tempFiles = res.tempFiles;\n        this.setData({\n          images: this.data.images.concat(res.tempFilePaths)\n        })\n        // 在选择图片时,对本地临时存储的图片,这个时候,进行图片的校验,当然你放在最后点击发布时,进行校验也是可以的,只不过是一个前置校验和后置校验的问题,我个人倾向于在选择图片时就进行校验的,选择一些照片时,就应该在选择时阶段做安全判断的, 小程序端请求云函数方式// 图片转化buffer后，调用云函数\n        console.log(tempFiles);\n        tempFiles.forEach(items => {\n          console.log(items);\n          // 图片转化buffer后，调用云函数\n          wx.getFileSystemManager().readFile({\n            filePath: items.path,\n            success: res => {\n                  console.log(res);\n                   wx.cloud.callFunction({ // 请求imgSecCheck云函数\n                    name: 'imgSecCheck',\n                    data: {\n                      img: res.data // 传入要检测的值\n                    }\n            })\n            .then(res => {\n               console.log(res);\n               let { errCode } = res.result.data;\n               switch(errCode) {\n                 case 87014:\n                   this.setData({\n                      resultText: '内容含有违法违规内容'\n                   })\n                   break;\n                 case 0:\n                   this.setData({\n                     resultText: '内容OK'\n                   })\n                   break;\n                 default:\n                   break;\n               }\n\n            })\n            .catch(err => {\n               console.error(err);\n            })\n            },\n            fail: err => {\n              console.error(err);\n            }\n          })\n        })\n\n\n        // 还能再选几张图片\n        max = MAX_IMG_NUM - this.data.images.length\n        this.setData({\n          selectPhoto: max <= 0 ? false : true  // 当超过9张时,加号隐藏\n        })\n      },\n    })\n  },\n\n  // 删除图片操作\n  onDelImage(event) {\n    const index = event.target.dataset.index;\n    // 点击删除当前图片,用splice方法,删除一张,从数组中移除一个\n    this.data.images.splice(index, 1);\n    this.setData({\n      images: this.data.images\n    })\n    // 当添加的图片达到设置最大的数量时,添加按钮隐藏,不让新添加图片\n   if (this.data.images.length == MAX_IMG_NUM - 1) {\n      this.setData({\n        selectPhoto: true,\n      })\n    }\n  },\n})\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br"),e("span",{staticClass:"line-number"},[s._v("61")]),e("br"),e("span",{staticClass:"line-number"},[s._v("62")]),e("br"),e("span",{staticClass:"line-number"},[s._v("63")]),e("br"),e("span",{staticClass:"line-number"},[s._v("64")]),e("br"),e("span",{staticClass:"line-number"},[s._v("65")]),e("br"),e("span",{staticClass:"line-number"},[s._v("66")]),e("br"),e("span",{staticClass:"line-number"},[s._v("67")]),e("br"),e("span",{staticClass:"line-number"},[s._v("68")]),e("br"),e("span",{staticClass:"line-number"},[s._v("69")]),e("br"),e("span",{staticClass:"line-number"},[s._v("70")]),e("br"),e("span",{staticClass:"line-number"},[s._v("71")]),e("br"),e("span",{staticClass:"line-number"},[s._v("72")]),e("br"),e("span",{staticClass:"line-number"},[s._v("73")]),e("br"),e("span",{staticClass:"line-number"},[s._v("74")]),e("br"),e("span",{staticClass:"line-number"},[s._v("75")]),e("br"),e("span",{staticClass:"line-number"},[s._v("76")]),e("br"),e("span",{staticClass:"line-number"},[s._v("77")]),e("br"),e("span",{staticClass:"line-number"},[s._v("78")]),e("br"),e("span",{staticClass:"line-number"},[s._v("79")]),e("br"),e("span",{staticClass:"line-number"},[s._v("80")]),e("br"),e("span",{staticClass:"line-number"},[s._v("81")]),e("br"),e("span",{staticClass:"line-number"},[s._v("82")]),e("br"),e("span",{staticClass:"line-number"},[s._v("83")]),e("br"),e("span",{staticClass:"line-number"},[s._v("84")]),e("br"),e("span",{staticClass:"line-number"},[s._v("85")]),e("br"),e("span",{staticClass:"line-number"},[s._v("86")]),e("br"),e("span",{staticClass:"line-number"},[s._v("87")]),e("br"),e("span",{staticClass:"line-number"},[s._v("88")]),e("br"),e("span",{staticClass:"line-number"},[s._v("89")]),e("br"),e("span",{staticClass:"line-number"},[s._v("90")]),e("br"),e("span",{staticClass:"line-number"},[s._v("91")]),e("br"),e("span",{staticClass:"line-number"},[s._v("92")]),e("br"),e("span",{staticClass:"line-number"},[s._v("93")]),e("br"),e("span",{staticClass:"line-number"},[s._v("94")]),e("br"),e("span",{staticClass:"line-number"},[s._v("95")]),e("br"),e("span",{staticClass:"line-number"},[s._v("96")]),e("br"),e("span",{staticClass:"line-number"},[s._v("97")]),e("br"),e("span",{staticClass:"line-number"},[s._v("98")]),e("br"),e("span",{staticClass:"line-number"},[s._v("99")]),e("br"),e("span",{staticClass:"line-number"},[s._v("100")]),e("br"),e("span",{staticClass:"line-number"},[s._v("101")]),e("br"),e("span",{staticClass:"line-number"},[s._v("102")]),e("br"),e("span",{staticClass:"line-number"},[s._v("103")]),e("br"),e("span",{staticClass:"line-number"},[s._v("104")]),e("br"),e("span",{staticClass:"line-number"},[s._v("105")]),e("br"),e("span",{staticClass:"line-number"},[s._v("106")]),e("br"),e("span",{staticClass:"line-number"},[s._v("107")]),e("br")])]),e("p",[s._v('示例效果如下所示:\n<img class="medium-zoom lazy" loading="lazy" alt="完成动态展示"" src="../images/img-security-check/finish-imgSecCheck.gif" >\n至此,关于图片安全检测就已经完成了,您只需要根据检测的结果,做一些友好的用户提示,或者做一些自己的业务逻辑判断即可')]),s._v(" "),e("h2",{attrs:{id:"常见问题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#常见问题"}},[s._v("#")]),s._v(" 常见问题")]),s._v(" "),e("ul",[e("li",[e("h3",{attrs:{id:"如何对上传的图片大小进行限制"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#如何对上传的图片大小进行限制"}},[s._v("#")]),s._v(" 如何对上传的图片大小进行限制")])])]),s._v(" "),e("p",[s._v("有时候,您需要对用户上传图片的大小进行限制,限制用户任意上传超大图片,那怎么处理呢,在微信小程序里面,主要借助的是 "),e("code",[s._v("wx.chooseImage")]),s._v(" 这个接口成功返回后临时路径的 "),e("code",[s._v("res.tempFiles")]),s._v(" 中的 "),e("code",[s._v("size")]),s._v("大小判断即可进行处理\n"),e("img",{staticClass:"medium-zoom lazy",attrs:{loading:"lazy",alt:"限制图片大小",src:a(771)}}),s._v("\n具体实例代码如下所示")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("// 选择图片\nonChooseImage() {\n  // 还能再选几张图片,初始值设置最大的数量-当前的图片的长度\n  let max = MAX_IMG_NUM - this.data.images.length;\n  wx.chooseImage({\n    count: max,\n    sizeType: ['original', 'compressed'],\n    sourceType: ['album', 'camera'],\n    success: (res) => {\n      console.log(res)\n      const tempFiles = res.tempFiles;\n      this.setData({\n        images: this.data.images.concat(res.tempFilePaths) // tempFilePath可以作为img标签的src属性显示图片\n      })\n      // 在选择图片时,对本地临时存储的图片,这个时候,进行图片的校验,当然你放在最后点击发布时,进行校验也是可以的,只不过是一个前置校验和后置校验的问题,我个人倾向于在选择图片时就进行校验的,选择一些照片时,就应该在选择时阶段做安全判断的, 小程序端请求云函数方式// 图片转化buffer后，调用云函数\n      console.log(tempFiles);\n      tempFiles.forEach(items => {\n        if (items && items.size > 1 * (1024 * 1024)) { // 限制图片的大小\n          wx.showToast({\n            icon: 'none',\n            title: '上传的图片超过1M,禁止用户上传',\n            duration: 4000\n          })\n          // 超过1M的图片,禁止用户上传\n        }\n        console.log(items);\n        // 图片转化buffer后，调用云函数\n        wx.getFileSystemManager().readFile({\n          filePath: items.path,\n          success: res => {\n                console.log(res);\n                  wx.cloud.callFunction({   // 请求调用云函数imgSecCheck\n                  name: 'imgSecCheck',\n                  data: {\n                    img: res.data\n                  }\n          })\n          .then(res => {\n              console.log(res);\n              let { errCode } = res.result.data;\n              switch(errCode) {\n                case 87014:\n                  this.setData({\n                    resultText: '内容含有违法违规内容'\n                  })\n                  break;\n                case 0:\n                  this.setData({\n                    resultText: '内容OK'\n                  })\n                  break;\n                default:\n                  break;\n              }\n          })\n          .catch(err => {\n              console.error(err);\n          })\n          },\n          fail: err => {\n            console.error(err);\n          }\n        })\n      })\n\n      // 还能再选几张图片\n      max = MAX_IMG_NUM - this.data.images.length\n      this.setData({\n        selectPhoto: max <= 0 ? false : true // 当超过9张时,加号隐藏\n      })\n    },\n  })\n},\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br"),e("span",{staticClass:"line-number"},[s._v("61")]),e("br"),e("span",{staticClass:"line-number"},[s._v("62")]),e("br"),e("span",{staticClass:"line-number"},[s._v("63")]),e("br"),e("span",{staticClass:"line-number"},[s._v("64")]),e("br"),e("span",{staticClass:"line-number"},[s._v("65")]),e("br"),e("span",{staticClass:"line-number"},[s._v("66")]),e("br"),e("span",{staticClass:"line-number"},[s._v("67")]),e("br"),e("span",{staticClass:"line-number"},[s._v("68")]),e("br"),e("span",{staticClass:"line-number"},[s._v("69")]),e("br"),e("span",{staticClass:"line-number"},[s._v("70")]),e("br"),e("span",{staticClass:"line-number"},[s._v("71")]),e("br"),e("span",{staticClass:"line-number"},[s._v("72")]),e("br"),e("span",{staticClass:"line-number"},[s._v("73")]),e("br")])]),e("p",[s._v("实例效果如下所示:\n"),e("img",{staticClass:"medium-zoom lazy",attrs:{loading:"lazy",alt:"限制图片大小",src:a(772)}})]),s._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[s._v("注意:")]),s._v(" "),e("p",[s._v("使用微信官方的图片内容安全接口进行校验,限制图片大小限制:1M,否则的话就会报错,如下所示")])]),s._v(" "),e("img",{staticClass:"medium-zoom lazy",attrs:{loading:"lazy",alt:"超过1M大小就会报错",src:a(773)}}),s._v(" "),e("p",[s._v("也就是说,"),e("strong",[s._v("对于超过 1M 大小的违规图片,微信官方提供的这个图片安全接口是无法进行校验的")]),s._v("。")]),s._v(" "),e("p",[s._v("这个根据自己的业务而定,小程序端对用户上传图片的大小是进行了限制的。如果您觉得微信官方提供的图片安全接口满足不了自己的业务需求,那么可以选择一些其他的图片内容安全校验接口。")]),s._v(" "),e("p",[s._v("图片安全校验是非常有必要的,用户一旦上传非法图片,一旦通过网络进行传播,产生了社会影响,平台将会被追究责任,我们要吸取前车之鉴带给我的教训")]),s._v(" "),e("h3",{attrs:{id:"如何解决多图上传覆盖的问题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#如何解决多图上传覆盖的问题"}},[s._v("#")]),s._v(" 如何解决多图上传覆盖的问题")]),s._v(" "),e("p",[s._v("对于上传图片来说,这个"),e("code",[s._v("wx.cloud.uploadFileAPI")]),s._v("接口只能上传一张图片,但是很多时候,是需要上传多张图片到云存储当中的,当点击发布的时候,我们是希望将多张图片都上传到云存储当中。")]),s._v(" "),e("p",[s._v("这个 API 虽然只能每次上传一张,但您可以循环遍历多张图片,然后一张一张上传。")]),s._v(" "),e("p",[s._v("在"),e("code",[s._v("cloudPath")]),s._v("上传文件的参数当中,它的值:需要注意:文件的名称。")]),s._v(" "),e("p",[s._v("那如何保证上传的图片不被覆盖呢？其实文件不重名的情况下就不会被覆盖，而在选择图片的时候,不应该上传,因为用户可能有删除等操作,如果直接上传的话会造成资源的浪费，应该在点发布按钮的时候,才执行上传操作,文件不重名覆盖的示例代码如下所示")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("    let promiseArr = []\n    let fileIds = []     // 将图片的fileId存放到一个数组中\n    let imgLength = this.data.images.length;\n    // 图片上传,循环遍历\n    for (let i = 0; i < imgLength; i++) {\n      let p = new Promise((resolve, reject) => {\n      let item = this.data.images[i]\n        // 文件扩展名\n        let suffix = /\\.\\w+$/.exec(item)[0]; // 取文件后拓展名\n        wx.cloud.uploadFile({     // 利用官方提供的上传接口\n          cloudPath: 'blog/' + Date.now() + '-' + Math.random() * 1000000 + suffix, // 云存储路径,您也可以使用es6中的模板字符串进行拼接的\n          filePath: item,   // 要上传文件资源的路径\n          success: (res) => {\n            console.log(res);\n            console.log(res.fileID)\n            fileIds = fileIds.concat(res.fileID)       // 将新上传的与之前上传的给拼接起来\n            resolve()\n          },\n          fail: (err) => {\n            console.error(err)\n            reject()\n          }\n        })\n      })\n      promiseArr.push(p)\n    }\n    // 存入到云数据库,其中这个Promise.all(),等待里面所有的任务都执行之后,在去执行后面的任务,也就是等待上传所有的图片上传完后,才能把相对应的数据存到数据库当中,具体与promise相关问题,可自行查漏\n    Promise.all(promiseArr).then((res) => {\n        db.collection('blog').add({ // 查找blog集合,将img,时间等数据添加到这个集合当中\n          data: {\n            img: fileIds,\n            createTime: db.serverDate(), // 服务端的时间\n          }\n        }).then((res) => {\n          console.log(res);\n          this._hideToastTip();\n          this._successTip();\n        })\n      })\n      .catch((err) => {\n        // 发布失败console.error(err);\n      })\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br")])]),e("p",[s._v("上面通过利用当前时间+随机数的方式进行了一个区分,规避了上传文件同名的问题：")]),s._v(" "),e("p",[s._v("因为这个上传接口,一次性只能上传一张图片,所以需要循环遍历图片,然后一张张的上传。")]),s._v(" "),e("p",[e("strong",[s._v("一个是上传到云存储中")]),s._v(","),e("strong",[s._v("另一个是添加到云数据库集合当中")]),s._v(",要分别注意下这两个操作,云数据库中的图片是从云存储中拿到的,然后再添加到云数据库当中去的。")]),s._v(" "),e("p",[s._v("示例效果如下所示:")]),s._v(" "),e("img",{staticClass:"medium-zoom lazy",attrs:{loading:"lazy",alt:"上传大小限制",src:a(519)}}),s._v(" "),e("img",{staticClass:"medium-zoom lazy",attrs:{loading:"lazy",alt:"云存储",src:a(519)}}),s._v(" "),e("p",[s._v("将上传的图片存储到云数据库中")]),s._v(" "),e("img",{staticClass:"medium-zoom lazy",attrs:{loading:"lazy",alt:"云数据库",src:a(774)}}),s._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[s._v("警告:")]),s._v(" "),e("p",[s._v("添加数据到云数据库中,需要手动创建集合,不然是无法上传不到云数据库当中的,会报错")])]),s._v(" "),e("p",[s._v("至此,关于敏感图片的检测,以及多图片的上传到这里就已经完成了！")]),s._v(" "),e("p",[s._v("如下是完整的小程序端逻辑示例代码")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("// miniprogram/pages/imgSecCheck/imgSecCheck.js\n// 最大上传图片数量\nconst MAX_IMG_NUM = 9;\nconst db = wx.cloud.database()\nPage({\n\n/**\n  * 页面的初始数据\n  */\ndata: {\n  images: [],\n  selectPhoto: true, // 添加图片元素是否显示\n},\n\n/**\n  * 生命周期函数--监听页面加载\n  */\nonLoad: function (options) {\n\n},\n\n// 选择图片\nonChooseImage() {\n  // 还能再选几张图片,初始值设置最大的数量-当前的图片的长度\n  let max = MAX_IMG_NUM - this.data.images.length;\n  wx.chooseImage({\n    count: max,\n    sizeType: ['original', 'compressed'],\n    sourceType: ['album', 'camera'],\n    success: (res) => {\n      console.log(res)\n      const tempFiles = res.tempFiles;\n      this.setData({\n        images: this.data.images.concat(res.tempFilePaths) // tempFilePath可以作为img标签的src属性显示图片\n      })\n      // 在选择图片时,对本地临时存储的图片,这个时候,进行图片的校验,当然你放在最后点击发布时,进行校验也是可以的,只不过是一个前置校验和后置校验的问题,我个人倾向于在选择图片时就进行校验的,选择一些照片时,就应该在选择时阶段做安全判断的, 小程序端请求云函数方式\n      // 图片转化buffer后，调用云函数\n      console.log(tempFiles);\n      tempFiles.forEach(items => {\n        if (items && items.size > 1 * (1024 * 1024)) {\n          wx.showToast({\n            icon: 'none',\n            title: '上传的图片超过1M,禁止用户上传',\n            duration: 4000\n          })\n          // 超过1M的图片,禁止上传\n        }\n        console.log(items);\n        // 图片转化buffer后，调用云函数\n        wx.getFileSystemManager().readFile({\n          filePath: items.path,\n          success: res => {\n            console.log(res);\n            this._checkImgSafe(res.data); // 检测图片安全校验\n          },\n          fail: err => {\n            console.error(err);\n          }\n        })\n      })\n\n\n      // 还能再选几张图片\n      max = MAX_IMG_NUM - this.data.images.length\n      this.setData({\n        selectPhoto: max <= 0 ? false : true // 当超过9张时,加号隐藏\n      })\n    },\n  })\n},\n\n// 删除图片\nonDelImage(event) {\n  const index = event.target.dataset.index;\n  // 点击删除当前图片,用splice方法,删除一张,从数组中移除一个\n  this.data.images.splice(index, 1);\n  this.setData({\n    images: this.data.images\n  })\n  // 当添加的图片达到设置最大的数量时,添加按钮隐藏,不让新添加图片\n  if (this.data.images.length == MAX_IMG_NUM - 1) {\n    this.setData({\n      selectPhoto: true,\n    })\n  }\n},\n\n// 点击发布按钮,将图片上传到云数据库当中\nsend() {\n  const images = this.data.images.length;\n  if (images) {\n    this._showToastTip();\n    let promiseArr = []\n    let fileIds = []\n    let imgLength = this.data.images.length;\n    // 图片上传\n    for (let i = 0; i < imgLength; i++) {\n      let p = new Promise((resolve, reject) => {\n        let item = this.data.images[i]\n        // 文件扩展名\n        let suffix = /\\.\\w+$/.exec(item)[0]; // 取文件后拓展名\n        wx.cloud.uploadFile({   // 上传图片至云存储,循环遍历,一张张的上传\n          cloudPath: 'blog/' + Date.now() + '-' + Math.random() * 1000000 + suffix,\n          filePath: item,\n          success: (res) => {\n            console.log(res);\n            console.log(res.fileID)\n            fileIds = fileIds.concat(res.fileID)\n            resolve()\n\n          },\n          fail: (err) => {\n            console.error(err)\n            reject()\n          }\n        })\n      })\n      promiseArr.push(p)\n    }\n    // 存入到云数据库\n    Promise.all(promiseArr).then((res) => {\n        db.collection('blog').add({ // 查找blog集合,将数据添加到这个集合当中\n          data: {\n            img: fileIds,\n            createTime: db.serverDate(), // 服务端的时间\n          }\n        }).then((res) => {\n          console.log(res);\n          this._hideToastTip();\n          this._successTip();\n        })\n      })\n      .catch((err) => {\n        // 发布失败\n        console.error(err);\n      })\n  } else {\n    wx.showToast({\n      icon: 'none',\n      title: '没有选择任何图片,发布不了',\n    })\n  }\n\n},\n\n// 校验图片的安全\n_checkImgSafe(data) {\n  wx.cloud.callFunction({\n      name: 'imgSecCheck',\n      data: {\n        img: data\n      }\n    })\n    .then(res => {\n      console.log(res);\n      let {\n        errCode\n      } = res.result.data;\n      switch (errCode) {\n        case 87014:\n          this.setData({\n            resultText: '内容含有违法违规内容'\n          })\n          break;\n        case 0:\n          this.setData({\n            resultText: '内容OK'\n          })\n          break;\n        default:\n          break;\n      }\n    })\n    .catch(err => {\n      console.error(err);\n    })\n},\n\n_showToastTip() {\n  wx.showToast({\n    icon: 'none',\n    title: '发布中...',\n  })\n},\n\n_hideToastTip() {\n  wx.hideLoading();\n},\n\n_successTip() {\n  wx.showToast({\n    icon: 'none',\n    title: '发布成功',\n  })\n},\n})\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br"),e("span",{staticClass:"line-number"},[s._v("55")]),e("br"),e("span",{staticClass:"line-number"},[s._v("56")]),e("br"),e("span",{staticClass:"line-number"},[s._v("57")]),e("br"),e("span",{staticClass:"line-number"},[s._v("58")]),e("br"),e("span",{staticClass:"line-number"},[s._v("59")]),e("br"),e("span",{staticClass:"line-number"},[s._v("60")]),e("br"),e("span",{staticClass:"line-number"},[s._v("61")]),e("br"),e("span",{staticClass:"line-number"},[s._v("62")]),e("br"),e("span",{staticClass:"line-number"},[s._v("63")]),e("br"),e("span",{staticClass:"line-number"},[s._v("64")]),e("br"),e("span",{staticClass:"line-number"},[s._v("65")]),e("br"),e("span",{staticClass:"line-number"},[s._v("66")]),e("br"),e("span",{staticClass:"line-number"},[s._v("67")]),e("br"),e("span",{staticClass:"line-number"},[s._v("68")]),e("br"),e("span",{staticClass:"line-number"},[s._v("69")]),e("br"),e("span",{staticClass:"line-number"},[s._v("70")]),e("br"),e("span",{staticClass:"line-number"},[s._v("71")]),e("br"),e("span",{staticClass:"line-number"},[s._v("72")]),e("br"),e("span",{staticClass:"line-number"},[s._v("73")]),e("br"),e("span",{staticClass:"line-number"},[s._v("74")]),e("br"),e("span",{staticClass:"line-number"},[s._v("75")]),e("br"),e("span",{staticClass:"line-number"},[s._v("76")]),e("br"),e("span",{staticClass:"line-number"},[s._v("77")]),e("br"),e("span",{staticClass:"line-number"},[s._v("78")]),e("br"),e("span",{staticClass:"line-number"},[s._v("79")]),e("br"),e("span",{staticClass:"line-number"},[s._v("80")]),e("br"),e("span",{staticClass:"line-number"},[s._v("81")]),e("br"),e("span",{staticClass:"line-number"},[s._v("82")]),e("br"),e("span",{staticClass:"line-number"},[s._v("83")]),e("br"),e("span",{staticClass:"line-number"},[s._v("84")]),e("br"),e("span",{staticClass:"line-number"},[s._v("85")]),e("br"),e("span",{staticClass:"line-number"},[s._v("86")]),e("br"),e("span",{staticClass:"line-number"},[s._v("87")]),e("br"),e("span",{staticClass:"line-number"},[s._v("88")]),e("br"),e("span",{staticClass:"line-number"},[s._v("89")]),e("br"),e("span",{staticClass:"line-number"},[s._v("90")]),e("br"),e("span",{staticClass:"line-number"},[s._v("91")]),e("br"),e("span",{staticClass:"line-number"},[s._v("92")]),e("br"),e("span",{staticClass:"line-number"},[s._v("93")]),e("br"),e("span",{staticClass:"line-number"},[s._v("94")]),e("br"),e("span",{staticClass:"line-number"},[s._v("95")]),e("br"),e("span",{staticClass:"line-number"},[s._v("96")]),e("br"),e("span",{staticClass:"line-number"},[s._v("97")]),e("br"),e("span",{staticClass:"line-number"},[s._v("98")]),e("br"),e("span",{staticClass:"line-number"},[s._v("99")]),e("br"),e("span",{staticClass:"line-number"},[s._v("100")]),e("br"),e("span",{staticClass:"line-number"},[s._v("101")]),e("br"),e("span",{staticClass:"line-number"},[s._v("102")]),e("br"),e("span",{staticClass:"line-number"},[s._v("103")]),e("br"),e("span",{staticClass:"line-number"},[s._v("104")]),e("br"),e("span",{staticClass:"line-number"},[s._v("105")]),e("br"),e("span",{staticClass:"line-number"},[s._v("106")]),e("br"),e("span",{staticClass:"line-number"},[s._v("107")]),e("br"),e("span",{staticClass:"line-number"},[s._v("108")]),e("br"),e("span",{staticClass:"line-number"},[s._v("109")]),e("br"),e("span",{staticClass:"line-number"},[s._v("110")]),e("br"),e("span",{staticClass:"line-number"},[s._v("111")]),e("br"),e("span",{staticClass:"line-number"},[s._v("112")]),e("br"),e("span",{staticClass:"line-number"},[s._v("113")]),e("br"),e("span",{staticClass:"line-number"},[s._v("114")]),e("br"),e("span",{staticClass:"line-number"},[s._v("115")]),e("br"),e("span",{staticClass:"line-number"},[s._v("116")]),e("br"),e("span",{staticClass:"line-number"},[s._v("117")]),e("br"),e("span",{staticClass:"line-number"},[s._v("118")]),e("br"),e("span",{staticClass:"line-number"},[s._v("119")]),e("br"),e("span",{staticClass:"line-number"},[s._v("120")]),e("br"),e("span",{staticClass:"line-number"},[s._v("121")]),e("br"),e("span",{staticClass:"line-number"},[s._v("122")]),e("br"),e("span",{staticClass:"line-number"},[s._v("123")]),e("br"),e("span",{staticClass:"line-number"},[s._v("124")]),e("br"),e("span",{staticClass:"line-number"},[s._v("125")]),e("br"),e("span",{staticClass:"line-number"},[s._v("126")]),e("br"),e("span",{staticClass:"line-number"},[s._v("127")]),e("br"),e("span",{staticClass:"line-number"},[s._v("128")]),e("br"),e("span",{staticClass:"line-number"},[s._v("129")]),e("br"),e("span",{staticClass:"line-number"},[s._v("130")]),e("br"),e("span",{staticClass:"line-number"},[s._v("131")]),e("br"),e("span",{staticClass:"line-number"},[s._v("132")]),e("br"),e("span",{staticClass:"line-number"},[s._v("133")]),e("br"),e("span",{staticClass:"line-number"},[s._v("134")]),e("br"),e("span",{staticClass:"line-number"},[s._v("135")]),e("br"),e("span",{staticClass:"line-number"},[s._v("136")]),e("br"),e("span",{staticClass:"line-number"},[s._v("137")]),e("br"),e("span",{staticClass:"line-number"},[s._v("138")]),e("br"),e("span",{staticClass:"line-number"},[s._v("139")]),e("br"),e("span",{staticClass:"line-number"},[s._v("140")]),e("br"),e("span",{staticClass:"line-number"},[s._v("141")]),e("br"),e("span",{staticClass:"line-number"},[s._v("142")]),e("br"),e("span",{staticClass:"line-number"},[s._v("143")]),e("br"),e("span",{staticClass:"line-number"},[s._v("144")]),e("br"),e("span",{staticClass:"line-number"},[s._v("145")]),e("br"),e("span",{staticClass:"line-number"},[s._v("146")]),e("br"),e("span",{staticClass:"line-number"},[s._v("147")]),e("br"),e("span",{staticClass:"line-number"},[s._v("148")]),e("br"),e("span",{staticClass:"line-number"},[s._v("149")]),e("br"),e("span",{staticClass:"line-number"},[s._v("150")]),e("br"),e("span",{staticClass:"line-number"},[s._v("151")]),e("br"),e("span",{staticClass:"line-number"},[s._v("152")]),e("br"),e("span",{staticClass:"line-number"},[s._v("153")]),e("br"),e("span",{staticClass:"line-number"},[s._v("154")]),e("br"),e("span",{staticClass:"line-number"},[s._v("155")]),e("br"),e("span",{staticClass:"line-number"},[s._v("156")]),e("br"),e("span",{staticClass:"line-number"},[s._v("157")]),e("br"),e("span",{staticClass:"line-number"},[s._v("158")]),e("br"),e("span",{staticClass:"line-number"},[s._v("159")]),e("br"),e("span",{staticClass:"line-number"},[s._v("160")]),e("br"),e("span",{staticClass:"line-number"},[s._v("161")]),e("br"),e("span",{staticClass:"line-number"},[s._v("162")]),e("br"),e("span",{staticClass:"line-number"},[s._v("163")]),e("br"),e("span",{staticClass:"line-number"},[s._v("164")]),e("br"),e("span",{staticClass:"line-number"},[s._v("165")]),e("br"),e("span",{staticClass:"line-number"},[s._v("166")]),e("br"),e("span",{staticClass:"line-number"},[s._v("167")]),e("br"),e("span",{staticClass:"line-number"},[s._v("168")]),e("br"),e("span",{staticClass:"line-number"},[s._v("169")]),e("br"),e("span",{staticClass:"line-number"},[s._v("170")]),e("br"),e("span",{staticClass:"line-number"},[s._v("171")]),e("br"),e("span",{staticClass:"line-number"},[s._v("172")]),e("br"),e("span",{staticClass:"line-number"},[s._v("173")]),e("br"),e("span",{staticClass:"line-number"},[s._v("174")]),e("br"),e("span",{staticClass:"line-number"},[s._v("175")]),e("br"),e("span",{staticClass:"line-number"},[s._v("176")]),e("br"),e("span",{staticClass:"line-number"},[s._v("177")]),e("br"),e("span",{staticClass:"line-number"},[s._v("178")]),e("br"),e("span",{staticClass:"line-number"},[s._v("179")]),e("br"),e("span",{staticClass:"line-number"},[s._v("180")]),e("br"),e("span",{staticClass:"line-number"},[s._v("181")]),e("br"),e("span",{staticClass:"line-number"},[s._v("182")]),e("br"),e("span",{staticClass:"line-number"},[s._v("183")]),e("br"),e("span",{staticClass:"line-number"},[s._v("184")]),e("br"),e("span",{staticClass:"line-number"},[s._v("185")]),e("br"),e("span",{staticClass:"line-number"},[s._v("186")]),e("br"),e("span",{staticClass:"line-number"},[s._v("187")]),e("br"),e("span",{staticClass:"line-number"},[s._v("188")]),e("br"),e("span",{staticClass:"line-number"},[s._v("189")]),e("br"),e("span",{staticClass:"line-number"},[s._v("190")]),e("br"),e("span",{staticClass:"line-number"},[s._v("191")]),e("br"),e("span",{staticClass:"line-number"},[s._v("192")]),e("br"),e("span",{staticClass:"line-number"},[s._v("193")]),e("br"),e("span",{staticClass:"line-number"},[s._v("194")]),e("br"),e("span",{staticClass:"line-number"},[s._v("195")]),e("br"),e("span",{staticClass:"line-number"},[s._v("196")]),e("br")])]),e("p",[s._v("完整的示例"),e("code",[s._v("wxml")]),s._v(",如下所示：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('<view class="image-list">\n\x3c!-- 显示图片 --\x3e\n<block wx:for="{{images}}" wx:key="*this">\n    <view class="image-wrap"><image class="image" src="{{item}}" mode="aspectFill" bind:tap="onPreviewImage" data-imgsrc="{{item}}"></image><i class="iconfont icon-shanchu" bind:tap="onDelImage" data-index="{{index}}"></i>\n    </view>\n</block>\n\x3c!-- 选择图片 --\x3e\n<view class="image-wrap selectphoto" hidden="{{!selectPhoto}}" bind:tap="onChooseImage"><i class="iconfont icon-add"></i></view>\n</view>\n<view class="footer">\n  <button class="send-btn" bind:tap="send">发布</button>\n</view>\n<view>\n  检测结果显示: {{ resultText }}\n</view>\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br")])]),e("p",[s._v("云函数端的代码")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("// 云函数入口文件\nconst cloud = require('wx-server-sdk');\ncloud.init({\nenv: cloud.DYNAMIC_CURRENT_ENV\n})\n\n// 云函数入口函数\nexports.main = async (event, context) => {\nconst wxContext = cloud.getWXContext()\ntry {\n  const result = await cloud.openapi.security.imgSecCheck({\n    media: {\n      contentType: 'image/png',\n      value: Buffer.from(event.img)   // 这里必须要将小程序端传过来的进行Buffer转化,否则就会报错,接口异常\n    }\n\n  })\n\n  if (result && result.errCode.toString() === '87014') {\n    return { code: 500, msg: '内容含有违法违规内容', data: result }\n  } else {\n    return { code: 200, msg: '内容ok', data: result }\n  }\n} catch (err) {\n  // 错误处理\n  if (err.errCode.toString() === '87014') {\n    return { code: 500, msg: '内容含有违法违规内容', data: err }\n  }\n  return { code: 502, msg: '调用imgSecCheck接口异常', data: err }\n}\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br")])]),e("p",[s._v("您可以根据自己的业务逻辑需要,一旦检测到图片违规时,禁用按钮状态,或者给一些用户提示,都是可以的；在发布之前或者点击发布时,进行图片内容安全的校验都可以,一旦发现图片有违规时,就禁止继续后面的操作。")]),s._v(" "),e("h2",{attrs:{id:"结语"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#结语"}},[s._v("#")]),s._v(" 结语")]),s._v(" "),e("p",[s._v("本文主要通过借助官方提供的图片："),e("code",[s._v("security.imgSecCheck")])]),s._v(" "),e("p",[s._v("接口,实现了对图片安全的校验,实现起来,是相当方便的,对于基础性的校验,利用官方提供的这个接口,已经够用了的,但是如果想要更加严格的检测,可以引入一些第三方的内容安全强强校验,确保内容的安全。")]),s._v(" "),e("p",[s._v("实现了如何对上传的图片大小进行限制,以及解决同名图片上传覆盖的问题。\n如果小可爱们有对文本内容安全校验以及图片安全校验仍然有什么问题,可以在下方留言,一起探讨")]),s._v(" "),e("footer-FooterLink",{attrs:{isShareLink:!0,isDaShang:!0}})],1)}),[],!1,null,null,null);n.default=t.exports}}]);